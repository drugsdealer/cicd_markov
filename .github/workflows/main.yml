name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Build Docker image
        run: |
          echo "üõ† Building Docker image..."
          docker build -t drugsdealer/cicd_markov:${{ github.run_number }} .

      - name: Login to DockerHub
        uses: docker/login-action@v3
        with:
          username: "drugsdealer"       # –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π DockerHub username
          password: "${{ secrets.DOCKERHUB_TOKEN }}"

      - name: Push Docker image
        run: |
          echo "üì¶ Pushing Docker image..."
          docker push drugsdealer/cicd_markov:${{ github.run_number }}

      - name: Notify Telegram (test direct token)
        uses: appleboy/telegram-action@master
        with:
          to: "üî¢–¢–í–û–ô_TELEGRAM_ID_–°–Æ–î–ê"   # –Ω–∞–ø—Ä–∏–º–µ—Ä, 5361248875
          token: "8218668682:AAH3sp-Bd-485oEXdkUPTm0PqxaeOK11MD8"
          message: |
            ‚úÖ CI/CD –ø–∞–π–ø–ª–∞–π–Ω –æ—Ç—Ä–∞–±–æ—Ç–∞–ª —É—Å–ø–µ—à–Ω–æ!
            üöÄ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}
            üß± –ö–æ–º–º–∏—Ç: ${{ github.event.head_commit.message }}
            üîó DockerHub: https://hub.docker.com/repository/docker/drugsdealer/cicd_markov
            üïí –í–µ—Ä—Å–∏—è: v${{ github.run_number }}

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.run_number }}
          name: Release v${{ github.run_number }}
          body: |
            ‚úÖ CI/CD –ø—Ä–æ—à—ë–ª —É—Å–ø–µ—à–Ω–æ
            üê≥ Docker –æ–±—Ä–∞–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
            üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram
